define(["jquery","core/log"],function(a,b){return{init:function(c,d,e,f,g,h,i,j){var k=JSON.parse(j);b.debug("Lambda Time Tracker plugin AMD module initialised"),a(document).ready(function(){function j(b){a("body").addClass("modal-open"),a("body").append('<div class="modal-backdrop fade in"></div>'),a(b).addClass("in"),a(b).show()}function l(b){a(b).removeClass("in"),a(b).hide(),a("body").removeClass("modal-open"),a("div.modal-backdrop.in").remove()}function m(){a.ajax({url:A,contentType:"application/x-www-form-urlencoded",data:{logData:v},method:"POST",success:function(c){null!==c.data&&(a("#block-course-time-tracker-total-spent-time").html(c.data),c.showpopup&&null!==k&&0!==k.length&&a.each(c.data_mod,function(b,c){a.each(k,function(a,b){c.id==b.id&&b.unlock&&(D=c.id,j("#block-course-time-tracker-modal"))})})),null!==c.error&&"undefined"!=typeof c.error&&(clearInterval(s),clearInterval(t),b.debug("Lambda Time Tracker ajax log error message: "+c.error))},error:function(a,c,d){b.debug("Lambda Time Tracker ajax log error code: "+a.status),b.debug("Lambda Time Tracker ajax log error message: "+d)}})}function n(){j("#time-tracker-interrupt-modal"),clearInterval(s),clearInterval(t)}function o(){clearInterval(s),b.debug("Lambda Time Tracker session timeout")}var p,q,r,s,t,u,v=[],w=60*e*1e3,x=60*f*1e3,y=1e3*h,z=M.cfg.wwwroot+"/local/lambda_time_tracker",A=z+"/log.php",B=document.body.className,C=B.indexOf(" cmid-"),D=0;a('<div id="time-tracker-interrupt"></div>').appendTo(a("body")),a("#time-tracker-interrupt").load(z+"/interrupt_modal.html",function(c,d,e){"success"==d&&(b.debug("Lambda Time Tracker interrupt modal loaded"),a("#time-tracker-interrupt-modal-confirmation-message").html(i),a("#time-tracker-interrupt-modal button").click(function(){l("#time-tracker-interrupt-modal"),u="User confirmed his/her presence!",b.debug(u),s=setInterval(m,w),t=setInterval(n,x)}),a("#block-course-time-tracker-modal-unlock-reload").click(function(){location.reload(!0)}),a("#block-course-time-tracker-modal-unlock-skip").click(function(){l("#block-course-time-tracker-modal"),a.each(k,function(a,b){b.id==D&&(b.unlock=!1)})}),a("#block-course-time-tracker-modal button.close").click(function(){l("#block-course-time-tracker-modal")})),"error"==d&&b.debug("Error: "+e.status+": "+e.statusText)}),null!==d&&d>1&&(C!==-1?(p=B.substring(C+1),q=p.split(" "),r=q[0].split("-"),v.push({courseid:d,cmid:r[1],userid:c})):v.push({courseid:d,userid:c}),s=setInterval(m,w),1==g?t=setInterval(n,x):setTimeout(o,y))})}}});